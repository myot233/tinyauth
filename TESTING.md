# TinyAuth 功能测试指南

## 测试环境准备

1. 启动Minecraft服务器
2. 确保你有OP权限来执行管理员命令
3. 准备多个不同的IP地址进行测试（可以使用VPN或代理）

## 功能测试清单

### 1. IPv6显示修复测试

**测试步骤：**
1. 使用IPv6地址连接服务器
2. 注册并登录账号
3. 使用管理员账号执行 `/auth audit <玩家名>`
4. 检查IPv6地址是否完整显示

**预期结果：**
- IPv6地址应该完整显示，不被截断
- 显示格式应该清晰易读，带有颜色代码

### 2. IP登录限制功能测试

**配置准备：**
```toml
enableIPRestriction = true
maxAllowedIPs = 2
ipRestrictedMessage = "§c此账号已达到IP登录限制，请联系管理员"
```

**测试步骤：**
1. 从IP1注册新账号
2. 登出后从IP2登录同一账号
3. 登出后从IP3尝试登录同一账号
4. 检查是否被阻止登录

**预期结果：**
- IP1和IP2应该能正常登录
- IP3应该被阻止，显示IP限制消息

### 3. IP管理命令测试

**测试步骤：**
1. `/auth ip list <玩家>` - 查看玩家IP列表
2. `/auth ip add <玩家> 192.168.1.100` - 添加新IP
3. `/auth ip list <玩家>` - 确认IP已添加
4. `/auth ip remove <玩家> 192.168.1.100` - 移除IP
5. `/auth ip clear <玩家>` - 清空所有IP

**预期结果：**
- 所有命令应该正常执行
- IP列表应该正确更新
- 玩家应该收到相应的通知消息

### 4. 延迟消息和命令测试

**配置准备：**
```toml
loginDelayTicks = 60  # 3秒延迟
loginDelayMessage = "§a欢迎回来！祝你游戏愉快！"
loginDelayCommand = "say 欢迎 %player% 回到服务器！"
```

**测试步骤：**
1. 玩家登录账号
2. 等待3秒钟
3. 观察是否收到延迟消息
4. 观察服务器是否执行了延迟命令

**预期结果：**
- 登录3秒后玩家应该收到欢迎消息
- 服务器应该执行say命令，向所有玩家广播

### 5. 大屏幕提示功能测试

**配置准备：**
```toml
logoutTitleText = "§c§l账号已登出"
logoutSubtitleText = "§e你的账号已被管理员强制登出"
removeTitleText = "§4§l账号已注销"
removeSubtitleText = "§c你的账号已被管理员注销"
```

**测试步骤：**
1. 玩家正常登录账号
2. 管理员执行 `/auth logout <玩家>`
3. 观察玩家屏幕是否显示大标题提示
4. 管理员执行 `/auth remove <玩家>`
5. 观察玩家屏幕是否显示账号注销提示

**预期结果：**
- 被登出时应显示红色粗体"账号已登出"标题
- 副标题应显示黄色"你的账号已被管理员强制登出"
- 被注销时应显示深红色粗体"账号已注销"标题
- 副标题应显示红色"你的账号已被管理员注销"
- 标题应有淡入淡出动画效果（1秒淡入，3秒停留，1秒淡出）

## IPv6测试用例

### 测试用的IPv6地址格式
- 标准格式：`2001:db8:85a3::8a2e:370:7334`
- 压缩格式：`2001:db8::1`
- 本地链路：`fe80::1%eth0`
- 回环地址：`::1`

### 测试步骤
1. 配置网络环境使用IPv6
2. 从不同IPv6地址连接服务器
3. 注册和登录账号
4. 检查审计记录中的IPv6显示
5. 测试IP限制功能对IPv6的支持

## 边界条件测试

### IP限制边界测试
1. 设置 `maxAllowedIPs = 1`，测试单IP限制
2. 设置 `maxAllowedIPs = 10`，测试大量IP
3. 测试IP地址格式验证（无效IP地址）

### 延迟功能边界测试
1. 设置 `loginDelayTicks = 1`，测试最小延迟
2. 设置 `loginDelayTicks = 1200`，测试长延迟（1分钟）
3. 测试空消息和空命令的处理

## 性能测试

### 大量玩家测试
1. 模拟多个玩家同时在线
2. 检查IP检查逻辑的性能影响
3. 监控内存使用情况

### 数据持久化测试
1. 添加大量IP到玩家白名单
2. 重启服务器
3. 检查数据是否正确保存和加载

## 兼容性测试

### 向后兼容性
1. 使用现有玩家数据启动服务器
2. 检查现有玩家是否能正常登录
3. 验证现有数据不会丢失

### 配置兼容性
1. 测试默认配置（IP限制关闭）
2. 测试部分配置启用的情况
3. 测试配置文件缺失项的处理

## 故障排除

### 常见问题
1. **IPv6显示异常**：检查网络配置和IP解析逻辑
2. **IP限制不生效**：确认配置文件中 `enableIPRestriction = true`
3. **延迟消息不显示**：检查 `loginDelayTicks` 配置和计时器逻辑
4. **命令执行失败**：检查命令格式和权限设置

### 调试信息
- 查看服务器日志中的TinyAuth相关信息
- 检查玩家数据文件中的IP列表
- 使用调试模式查看详细执行流程

## 测试报告模板

```
测试日期：
测试环境：
Minecraft版本：
Forge版本：

功能测试结果：
□ IPv6显示修复 - 通过/失败
□ IP登录限制 - 通过/失败  
□ IP管理命令 - 通过/失败
□ 延迟消息功能 - 通过/失败
□ 大屏幕提示功能 - 通过/失败

发现的问题：
1. 
2. 
3. 

建议改进：
1. 
2. 
3. 
``` 